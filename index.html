<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EditFlow Pro - Enterprise Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --side-bg: #0f172a;
            --main-bg: #f1f5f9;
            --accent-blue: #3b82f6;
            --accent-orange: #fb923c;
            --white: #ffffff;
            --text-dark: #1e293b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--main-bg); display: flex; min-height: 100vh; overflow-x: hidden; }

        /* --- LOGIN SCREEN --- */
        #login-screen {
            height: 100vh; width: 100vw; display: flex; justify-content: center; align-items: center;
            background: linear-gradient(135deg, #cbd5e1 0%, #94a3b8 100%); position: fixed; z-index: 10000;
        }
        .login-box {
            background: var(--white); padding: 50px; border-radius: 30px; width: 90%; max-width: 450px;
            text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }
        .auth-input {
            width: 100%; padding: 15px; margin: 15px 0; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 280px; height: 100vh; background: var(--side-bg); color: white;
            position: fixed; padding: 40px 20px; display: flex; flex-direction: column; transition: 0.3s;
        }
        .sidebar h2 { font-size: 1.8rem; margin-bottom: 50px; color: var(--accent-orange); text-align: center; }
        .nav-item {
            padding: 15px 20px; color: #94a3b8; cursor: pointer; border-radius: 12px;
            margin-bottom: 10px; display: flex; align-items: center; gap: 15px; font-weight: 600;
        }
        .nav-item:hover, .nav-item.active { background: #1e293b; color: white; }
        .nav-item.active { border-left: 5px solid var(--accent-blue); }

        /* --- MAIN CONTENT --- */
        .content { margin-left: 280px; padding: 40px; width: calc(100% - 280px); transition: 0.3s; }
        
        /* Responsive Table & Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 15px rgba(0,0,0,0.05); border-bottom: 5px solid #ddd; }
        .stat-card h3 { font-size: 0.9rem; color: #64748b; margin-bottom: 10px; }
        .stat-card h2 { font-size: 2.2rem; }

        .table-card { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 15px rgba(0,0,0,0.05); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th, td { padding: 18px; text-align: left; border-bottom: 1px solid #f1f5f9; }
        th { color: #64748b; font-size: 0.85rem; text-transform: uppercase; }

        /* --- BILL SECTION --- */
        .bill-form { max-width: 600px; background: white; padding: 30px; border-radius: 20px; margin-bottom: 30px; }
        #invoice-template {
            width: 800px; background: white; padding: 50px; position: fixed; left: -2000px; /* Hidden for capture */
            border: 1px solid #ddd;
        }
        .invoice-header { display: flex; justify-content: space-between; border-bottom: 3px solid var(--accent-blue); padding-bottom: 20px; }
        
        /* --- BUTTONS --- */
        .btn-primary { background: var(--accent-blue); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .btn-done { background: #10b981; color: white; border: none; padding: 5px 12px; border-radius: 5px; cursor: pointer; }
        .btn-del { color: #ef4444; border: none; background: none; cursor: pointer; font-size: 1.2rem; }
        .btn-dl { background: var(--side-bg); color: var(--accent-orange); border: 2px solid var(--accent-orange); padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* --- MOBILE RESPONSIVE --- */
        @media (max-width: 1024px) {
            .sidebar { width: 80px; padding: 20px 10px; }
            .sidebar h2, .nav-item span { display: none; }
            .content { margin-left: 80px; width: calc(100% - 80px); padding: 20px; }
        }
        @media (max-width: 600px) {
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .content { padding: 15px; }
        }

        /* Bill Form Styling */
.bill-container {
    max-width: 600px;
    margin: 20px 0;
}

.bill-form-box {
    background: white;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.05);
}

.btn-generate {
    background: #3b82f6;
    color: white;
    border: none;
    width: 100%;
    padding: 15px;
    border-radius: 12px;
    font-weight: bold;
    font-size: 1rem;
    cursor: pointer;
    margin-top: 10px;
    transition: 0.3s;
}

.btn-generate:hover {
    background: #2563eb;
    transform: translateY(-2px);
}

.bill-form-box { background: white; padding: 40px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }

.item-row input { border: 2px solid #f1f5f9 !important; background: #f8fafc; }

.btn-generate { 
    background: #3b82f6; color: white; border: none; width: 100%; 
    padding: 18px; border-radius: 15px; font-weight: 800; 
    font-size: 1.1rem; cursor: pointer; transition: 0.3s; 
}

.btn-generate:hover { background: #1d4ed8; box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3); }

.btn-sm { padding: 8px 15px; border: none; border-radius: 8px; cursor: pointer; color: white; font-weight: 600; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h1 style="margin-bottom:10px;">EDITFLOW <span style="color:var(--accent-orange)">PRO</span></h1>
            <p style="color:#64748b">Secure Enterprise Access</p>
            <input type="password" id="user-pass" placeholder="Enter PIN " class="auth-input">
            <button class="btn-primary" style="width:100%; padding:15px;" onclick="handleAuth()">UNLOCK DASHBOARD</button>
            <p style="margin-top:20px; font-size:12px; color:#94a3b8"></p>
        </div>
    </div>

    <aside class="sidebar" id="sidebar-ui" style="display:none;">
        <h2>EF PRO</h2>
        <div class="nav-item active" onclick="showSection('dash', this)"><i class="fas fa-chart-line"></i> <span>Dashboard</span></div>
        <div class="nav-item" onclick="showSection('report', this)"><i class="fas fa-file-alt"></i> <span>Reports</span></div>
        <div class="nav-item" onclick="showSection('history', this)"><i class="fas fa-history"></i> <span>History</span></div>
        <div class="nav-item admin-only" onclick="showSection('bill', this)"><i class="fas fa-file-invoice-dollar"></i> <span>Create Bill</span></div>
        
        <button onclick="logout()" class="btn-primary" style="background:#ef4444; margin-top:auto; width:100%"><i class="fas fa-sign-out-alt"></i> <span>LOGOUT</span></button>
    </aside>

    <main class="content" id="main-ui" style="display:none;">
        
        <div id="section-dash" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
                <h1>Dashboard</h1>
                <button class="btn-primary admin-only" onclick="openModal()">+ NEW PROJECT</button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card" style="border-color:var(--accent-blue)"><h3>TOTAL PROJECTS</h3><h2 id="stat-total">0</h2></div>
                <div class="stat-card" style="border-color:#10b981"><h3>TOTAL REVENUE</h3><h2 id="stat-rev">$0</h2></div>
                <div class="stat-card" style="border-color:var(--accent-orange)"><h3>PENDING</h3><h2 id="stat-pend">0</h2></div>
                <div class="stat-card" style="border-color:#8b5cf6"><h3>COMPLETED</h3><h2 id="stat-done">0</h2></div>
            </div>

            <div class="table-card">
                <h3>Current Projects</h3>
                <table>
                    <thead>
                        <tr><th>Client</th><th>Budget ($)</th><th>Status</th><th class="admin-only">Action</th></tr>
                    </thead>
                    <tbody id="dash-list"></tbody>
                </table>
            </div>
        </div>

        <div id="section-history" class="tab-content" style="display:none;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
                <h1>Project History</h1>
                <button class="btn-dl" onclick="downloadCSV()">DOWNLOAD CSV</button>
            </div>
            <div class="table-card">
                <table id="hist-table">
                    <thead><tr><th>Date</th><th>Client</th><th>Budget</th><th>Status</th></tr></thead>
                    <tbody id="hist-list"></tbody>
                </table>
            </div>
        </div>

        <div id="section-bill" class="tab-content admin-only" style="display:none;">
            <div class="bill-container">
    <div class="bill-form-box">
        <h2 style="margin-bottom:20px;">Professional Itemized Bill</h2>
        
        <input type="text" id="bill-biz-num" placeholder="Your Business Number" class="auth-input">
        <div style="display:flex; gap:10px;">
            <input type="text" id="bill-client" placeholder="Client Name" class="auth-input">
            <input type="text" id="bill-client-num" placeholder="Client Number" class="auth-input">
        </div>

        <div id="items-container">
            <div class="item-row" style="display:flex; gap:10px; margin-bottom:10px;">
                <input type="text" placeholder="Work Description (e.g. Intro Edit)" class="auth-input desc-field" style="flex:3;">
                <input type="number" placeholder="Price ($)" class="auth-input price-field" style="flex:1;">
            </div>
        </div>

        <button class="btn-sm" onclick="addNewItemRow()" style="background:#64748b; margin-bottom:20px;">+ Add More Work</button>
        
        <button class="btn-generate" onclick="generateInvoice()">GENERATE & DOWNLOAD BILL</button>
    </div>
</div>

<div id="invoice-template" style="position: fixed; left: -5000px; width: 850px; background: white; padding: 60px; color: #1e293b;">
    <div style="display: flex; justify-content: space-between; border-bottom: 4px solid #3b82f6; padding-bottom: 30px;">
        <div>
            <h1 style="color:#3b82f6; font-size: 50px; margin: 0; letter-spacing: 2px;">INVOICE</h1>
            <p style="margin-top: 10px; font-size: 18px;">Business No: <span id="inv-biz-num" style="font-weight: bold;"></span></p>
        </div>
        <div style="text-align: right;">
            <h2 id="inv-num" style="margin: 0; font-size: 28px;">#INV-1001</h2>
            <p id="inv-date" style="color: #64748b; font-size: 18px; margin-top: 5px;"></p>
        </div>
    </div>

    <div style="margin: 50px 0;">
        <h3 style="color: #64748b; text-transform: uppercase; font-size: 16px; letter-spacing: 1px;">Bill To:</h3>
        <p id="inv-client" style="font-size: 30px; font-weight: 800; margin: 5px 0;"></p>
        <p style="font-size: 18px;">Client No: <span id="inv-client-num" style="font-weight: bold;"></span></p>
    </div>

    <table style="width: 100%; border-collapse: collapse; margin-top: 30px;">
        <thead>
            <tr style="background: #f1f5f9; text-align: left;">
                <th style="padding: 20px; border-bottom: 2px solid #cbd5e1; font-size: 18px;">Description</th>
                <th style="padding: 20px; border-bottom: 2px solid #cbd5e1; text-align: right; font-size: 18px;">Amount</th>
            </tr>
        </thead>
        <tbody id="inv-items-body">
            </tbody>
        <tfoot>
            <tr style="border-top: 3px solid #1e293b;">
                <td style="padding: 20px; font-size: 22px; font-weight: 800; text-align: right;">GRAND TOTAL:</td>
                <td id="inv-grand-total" style="padding: 20px; font-size: 22px; font-weight: 800; text-align: right; color: #3b82f6;"></td>
            </tr>
        </tfoot>
    </table>

    <div style="margin-top: 120px; display: flex; justify-content: flex-end;">
        <div style="text-align: center;">
            <p style="font-family: 'Brush Script MT', cursive; font-size: 55px; margin: 0; color: #1e293b;">H.K.Patel</p>
            <div style="border-top: 3px solid #1e293b; width: 250px; margin-top: -10px;"></div>
            <p style="font-weight: bold; margin-top: 10px; font-size: 16px; text-transform: uppercase; letter-spacing: 1px;">Authorized Signature</p>
        </div>
    </div>
</div>
        </div>

    </main>

    <div id="invoice-template">
        <div class="invoice-header">
            <div>
                <h1 style="color:var(--accent-blue)">INVOICE</h1>
                <p>EditFlow Pro Services</p>
            </div>
            <div style="text-align:right">
                <h2 id="inv-num">#INV-1001</h2>
                <p id="inv-date">Date: 2024-01-01</p>
            </div>
        </div>
        <div style="margin:40px 0;">
            <h3>Bill To:</h3>
            <p id="inv-client" style="font-size:1.5rem; font-weight:bold;"></p>
        </div>
        <table style="width:100%; margin-top:20px;">
            <thead style="background:#f8fafc">
                <tr><th>Description</th><th style="text-align:right">Amount</th></tr>
            </thead>
            <tbody>
                <tr><td id="inv-desc" style="padding:20px 0;"></td><td id="inv-total" style="text-align:right; font-weight:bold; font-size:1.2rem;"></td></tr>
            </tbody>
        </table>
        <div style="margin-top:100px; border-top:2px solid #eee; padding-top:20px; text-align:center; color:#64748b;">
            <p>Thank you for your business!</p>
            <p>Authorized Signature: _________________</p>
        </div>
    </div>

    <div id="modal-bg" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:10001; justify-content:center; align-items:center;">
        <div class="login-box">
            <h3>Add New Project</h3>
            <input type="text" id="p-client" placeholder="Client Name" class="auth-input">
            <input type="number" id="p-budget" placeholder="Budget in $" class="auth-input">
            <select id="p-status" class="auth-input">
                <option value="Pending">Pending</option>
                <option value="Completed">Completed</option>
            </select>
            <div style="display:flex; gap:10px;">
                <button class="btn-primary" onclick="addProject()">SAVE</button>
                <button class="btn-primary" style="background:#64748b" onclick="closeModal()">CANCEL</button>
            </div>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('ef_pro_data')) || [];
        let currentRole = "";

        // AUTHENTICATION
        function handleAuth() {
            const pass = document.getElementById('user-pass').value;
            if(pass === "3212") { currentRole = "admin"; initApp(); }
            else if(pass === "1502") { currentRole = "viewer"; initApp(); }
            else { alert("Access Denied!"); }
        }

        function initApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('sidebar-ui').style.display = 'flex';
            document.getElementById('main-ui').style.display = 'block';
            if(currentRole === "viewer") {
                document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
            }
            updateDashboard();
        }

        // NAVIGATION
        function showSection(id, el) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.getElementById('section-' + id).style.display = 'block';
            el.classList.add('active');
            if(id === 'history') updateHistory();
        }

        // DASHBOARD LOGIC
        function updateDashboard() {
            const list = document.getElementById('dash-list');
            list.innerHTML = "";
            let rev = 0, pend = 0, done = 0;

            db.forEach((p, i) => {
                const isDone = p.status === "Completed";
                list.innerHTML += `
                    <tr>
                        <td><b>${p.name}</b></td>
                        <td>$${Number(p.budget).toLocaleString()}</td>
                        <td style="color:${isDone?'#10b981':'#fb923c'}; font-weight:bold;">${p.status}</td>
                        <td class="admin-only">
                            ${!isDone ? `<button class="btn-done" onclick="markDone(${i})">Done</button>` : '<i class="fas fa-check"></i>'}
                            <button class="btn-del" onclick="del(${i})"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`;
                if(isDone) { rev += Number(p.budget); done++; } else { pend++; }
            });

            document.getElementById('stat-total').innerText = db.length;
            document.getElementById('stat-rev').innerText = "$" + rev.toLocaleString();
            document.getElementById('stat-pend').innerText = pend;
            document.getElementById('stat-done').innerText = done;
            localStorage.setItem('ef_pro_data', JSON.stringify(db));
        }

        // HISTORY
        function updateHistory() {
            const list = document.getElementById('hist-list');
            list.innerHTML = "";
            db.forEach(p => {
                list.innerHTML += `<tr><td>${p.date}</td><td>${p.name}</td><td>$${p.budget}</td><td>${p.status}</td></tr>`;
            });
        }

        // BILL GENERATOR (Professional Image Download)
        function generateInvoice() {
            const client = document.getElementById('bill-client').value;
            const desc = document.getElementById('bill-desc').value;
            const amt = document.getElementById('bill-amount').value;

            if(!client || !amt) return alert("Fill all details!");

            document.getElementById('inv-client').innerText = client;
            document.getElementById('inv-desc').innerText = desc;
            document.getElementById('inv-total').innerText = "$" + amt;
            document.getElementById('inv-date').innerText = "Date: " + new Date().toLocaleDateString();
            document.getElementById('inv-num').innerText = "#EF-" + Math.floor(Math.random()*9000 + 1000);

            const template = document.getElementById('invoice-template');
            template.style.left = "0"; // Bring to view for capture
            
            html2canvas(template).then(canvas => {
                const link = document.createElement('a');
                link.download = `EF_Invoice_${client}.png`;
                link.href = canvas.toDataURL();
                link.click();
                template.style.left = "-2000px"; // Hide back
            });
        }

        // HELPER FUNCTIONS
        function openModal() { document.getElementById('modal-bg').style.display = 'flex'; }
        function closeModal() { document.getElementById('modal-bg').style.display = 'none'; }
        function addProject() {
            db.push({
                name: document.getElementById('p-client').value,
                budget: document.getElementById('p-budget').value,
                status: document.getElementById('p-status').value,
                date: new Date().toLocaleDateString()
            });
            updateDashboard(); closeModal();
        }
        function markDone(i) { db[i].status = "Completed"; updateDashboard(); }
        function del(i) { if(confirm("Delete Project?")) { db.splice(i, 1); updateDashboard(); } }
        function logout() { location.reload(); }
        function downloadCSV() {
            let csv = "Date,Client,Budget,Status\n";
            db.forEach(p => csv += `${p.date},${p.name},${p.budget},${p.status}\n`);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'EditFlow_History.csv'; a.click();
        }

        function generateInvoice() {
    // 1. Get Values from inputs
    const bizNum = document.getElementById('bill-biz-num').value;
    const client = document.getElementById('bill-client').value;
    const clientNum = document.getElementById('bill-client-num').value;
    const desc = document.getElementById('bill-desc').value;
    const amount = document.getElementById('bill-amount').value;

    if(!client || !amount) {
        return alert("Bhai, Client Name aur Amount toh daalo!");
    }

    // 2. Put values into Template
    document.getElementById('inv-biz-num').innerText = bizNum;
    document.getElementById('inv-client').innerText = client;
    document.getElementById('inv-client-num').innerText = clientNum;
    document.getElementById('inv-desc').innerText = desc;
    document.getElementById('inv-total').innerText = "$" + amount;
    document.getElementById('inv-date').innerText = "Date: " + new Date().toLocaleDateString();
    document.getElementById('inv-num').innerText = "#INV-" + Math.floor(Math.random() * 9000 + 1000);

    // 3. Capture Template as Image
    const template = document.getElementById('invoice-template');
    template.style.left = "0px"; // Temporary show for capture

    html2canvas(template).then(canvas => {
        const link = document.createElement('a');
        link.download = `Invoice_HKPatel_${client}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
        
        template.style.left = "-5000px"; // Hide again
    });
}

// Function to add a new work row in the form
function addNewItemRow() {
    const container = document.getElementById('items-container');
    const newRow = document.createElement('div');
    newRow.className = 'item-row';
    newRow.style = 'display:flex; gap:10px; margin-bottom:10px;';
    newRow.innerHTML = `
        <input type="text" placeholder="Work Description" class="auth-input desc-field" style="flex:3;">
        <input type="number" placeholder="Price ($)" class="auth-input price-field" style="flex:1;">
    `;
    container.appendChild(newRow);
}

// Main Function to Generate the Bill
function generateInvoice() {
    // 1. Basic Info
    document.getElementById('inv-biz-num').innerText = document.getElementById('bill-biz-num').value;
    document.getElementById('inv-client').innerText = document.getElementById('bill-client').value;
    document.getElementById('inv-client-num').innerText = document.getElementById('bill-client-num').value;
    document.getElementById('inv-date').innerText = "Date: " + new Date().toLocaleDateString();
    document.getElementById('inv-num').innerText = "#EF-" + Math.floor(Math.random() * 90000 + 10000);

    // 2. Process Multiple Items
    const descFields = document.querySelectorAll('.desc-field');
    const priceFields = document.querySelectorAll('.price-field');
    const invBody = document.getElementById('inv-items-body');
    invBody.innerHTML = ""; // Clear old data
    
    let total = 0;

    for (let i = 0; i < descFields.length; i++) {
        let desc = descFields[i].value;
        let price = Number(priceFields[i].value);

        if (desc && price) {
            total += price;
            invBody.innerHTML += `
                <tr>
                    <td style="padding: 20px; border-bottom: 1px solid #f1f5f9; font-size: 18px;">${desc}</td>
                    <td style="padding: 20px; border-bottom: 1px solid #f1f5f9; text-align: right; font-weight: bold; font-size: 18px;">$${price.toLocaleString()}</td>
                </tr>
            `;
        }
    }

    document.getElementById('inv-grand-total').innerText = "$" + total.toLocaleString();

    // 3. Image Capture
    const template = document.getElementById('invoice-template');
    template.style.left = "0px";

    html2canvas(template).then(canvas => {
        const link = document.createElement('a');
        link.download = `Bill_H.K.Patel_${document.getElementById('bill-client').value}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
        template.style.left = "-5000px";
    });
}
    </script>
</body>
</html>